<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Oracle锁表解锁</title>
      <link href="//post/oracle-lock-watch-unlock-2u3p1x.html"/>
      <url>//post/oracle-lock-watch-unlock-2u3p1x.html</url>
      
        <content type="html"><![CDATA[<h1 id="Oracle锁表解锁"><a href="#Oracle锁表解锁" class="headerlink" title="Oracle锁表解锁"></a>Oracle锁表解锁</h1><h3 id="第一步：查询指定表会话信息"><a href="#第一步：查询指定表会话信息" class="headerlink" title="第一步：查询指定表会话信息"></a>第一步：查询指定表会话信息</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBJECT_NAME, SESSION_ID, LOCKED_MODE</span><br><span class="line"><span class="keyword">FROM</span> V$LOCKED_OBJECT LO</span><br><span class="line"><span class="keyword">JOIN</span> DBA_OBJECTS DO <span class="keyword">ON</span> LO.OBJECT_ID <span class="operator">=</span> DO.OBJECT_ID</span><br><span class="line"><span class="keyword">WHERE</span> OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;AT_EM_EQUIPMENT_CYCLE_PERIOD&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="第二步：识别持锁的会话"><a href="#第二步：识别持锁的会话" class="headerlink" title="第二步：识别持锁的会话"></a>第二步：识别持锁的会话</h3><p>你已经找到了持锁的会话 ID。接下来，可以查询这些会话的详细信息，以便更好地了解它们的状态：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SID, SERIAL#, USERNAME, STATUS, OSUSER, MACHINE</span><br><span class="line"><span class="keyword">FROM</span> V$SESSION</span><br><span class="line"><span class="keyword">WHERE</span> SID <span class="keyword">IN</span> (<span class="number">449</span>, <span class="number">479</span>, <span class="number">483</span>, <span class="number">799</span>, <span class="number">876</span>, <span class="number">887</span>, <span class="number">1220</span>);</span><br></pre></td></tr></table></figure><h3 id="第三步：检查长时间运行的事务"><a href="#第三步：检查长时间运行的事务" class="headerlink" title="第三步：检查长时间运行的事务"></a>第三步：检查长时间运行的事务</h3><p>检查这些会话是否涉及长时间运行的事务或是否被挂起：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SID, SERIAL#, USERNAME, STATUS, OSUSER, MACHINE, SQL_ID, LAST_CALL_ET</span><br><span class="line"><span class="keyword">FROM</span> V$SESSION</span><br><span class="line"><span class="keyword">WHERE</span> SID <span class="keyword">IN</span> (<span class="number">449</span>, <span class="number">479</span>, <span class="number">483</span>, <span class="number">799</span>, <span class="number">876</span>, <span class="number">887</span>, <span class="number">1220</span>);</span><br></pre></td></tr></table></figure><p>​<code>LAST_CALL_ET</code>​ 列显示了自上次调用以来的经过时间；较高的值可能表示事务运行时间过长。</p><h3 id="第四步：终止会话（如有必要）"><a href="#第四步：终止会话（如有必要）" class="headerlink" title="第四步：终止会话（如有必要）"></a>第四步：终止会话（如有必要）</h3><p>如果确定这些会话被挂起或长时间未响应，可以使用 <code>ALTER SYSTEM KILL SESSION</code>​ 命令终止它们，从而释放锁：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> KILL SESSION <span class="string">&#x27;SID,SERIAL#&#x27;</span>;</span><br></pre></td></tr></table></figure><p>请将 <code>SID</code>​ 和 <code>SERIAL#</code>​ 替换为之前查询中获取的实际值。</p><p>例如，要终止会话 449：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> KILL SESSION <span class="string">&#x27;449,XXXX&#x27;</span>;  <span class="comment">-- 替换 XXXX 为会话 449 的实际 SERIAL# </span></span><br></pre></td></tr></table></figure><h3 id="第五步：验证锁的释放"><a href="#第五步：验证锁的释放" class="headerlink" title="第五步：验证锁的释放"></a>第五步：验证锁的释放</h3><p>终止会话后，重新查询确认锁是否已释放：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> OBJECT_NAME, SESSION_ID, LOCKED_MODE</span><br><span class="line"><span class="keyword">FROM</span> V$LOCKED_OBJECT LO</span><br><span class="line"><span class="keyword">JOIN</span> DBA_OBJECTS DO <span class="keyword">ON</span> LO.OBJECT_ID <span class="operator">=</span> DO.OBJECT_ID</span><br><span class="line"><span class="keyword">WHERE</span> OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;AT_EM_EQUIPMENT_CYCLE_PERIOD&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
